<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Stats</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="../styles/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&family=Satisfy&display=swap');

        body {
            background: linear-gradient(90deg in hsl shorter hue, #fff5e6, #ffdbff);
        }

        .change-link {
            background-color: rgba(203, 33, 225, 0.417);
            border-radius: 5px;
            padding: 0;
            text-align: left;
        }

        /* Container fills width of the screen but keep a reasonable max size */
        #container {
          width: 100%;
          max-width: 900px; /* adjust as needed */
          height: auto;     /* height grows with content */
          margin: 0 auto;   /* center on page */
          display: block;
        }

        /* Make the SVG adapt to the container */
        #container svg {
          width: 100%;
          height: auto;
        }

        h2 {
            text-align: center;
            color: var(--primary);
            margin-top: 5%;
            font-family: "Satisfy", cursive;
            /* font-weight: 700; */
            font-size: 2.5rem;
        }

        p{
            line-height: 2.0;
            text-align: center;
            margin-left: 20%;
            margin-right: 20%;
        }

        .plays{
            list-style: none;
            text-align: center;
        }

        .shrink-text {
            font-size: 0.9rem;
        }

        span {
            font-style: italic;
        }

        .summary {
            margin-top: -50px;
        }

        .button-move {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
        }

        button {
            color: #F6BA20;
            background: #39257F;
            font-weight: bold;
            border-radius: 30px;
            padding: 6px 12px;
            width: auto;
            min-width: 60px;
        }

        button:hover {
            color: #39257F;
            background: #F6BA20;
        }

        .tooltip {
            position: absolute;
            width: max-content;
            height: 20px;
            padding: 0.5px;    
            text-align: center; 
            font-family:sans-serif;
            font-size: 14px;
            font-weight: bold;
            background: rgb(189, 217, 249);
            color: black; 
            border-radius: 7px;
        }

        .rules {
          border: 0.2rem outset rgba(156, 255, 156, 0.729);
          outline: 0.2rem solid rgba(123, 175, 197, 0.725);
          /* outline: 0.2rem solid rgba(0, 0, 0, 0.544); */
          border-radius: 40px 40px 40px 40px;

          /* --- text --- */
          font-weight: bold;
          font-family: sans-serif;
          font-size: clamp(0.75rem, 2.5vw, 1rem); /* scales between 1â€“1.5rem */

          /* --- spacing --- */
          margin: 2rem auto;      /* center horizontally */
          padding: 0px auto;
          outline-offset: 0.5rem;

          /* --- sizing --- */
          width: 90%;             /* take up most of the screen */
          max-width: 600px;       /* but donâ€™t get too wide */
          box-sizing: border-box; /* include borders in width */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) { /*this is for when screen is small*/
            h2 {
                font-size: 1.5rem;
                margin-top: 20%;
            }

            p,
            ul,
            li {
                padding: 0 5%;
                font-size: 0.95rem;
            }

            .shrink-text {
                font-size: 0.8rem;
            }

            #container {
              max-width: 100%;
            }
            #container text {
              font-size: 0.6rem; /* smaller axis labels on phones */
            }

            .rules {
              border-width: 0.1rem;
              outline-width: 0.1rem;
  }
        }

        @media (max-width: 480px) {
            h2 {
                font-size: 1.8rem;
                margin-left: 20%;
            }

            .button-move {
                gap: 5px;
            }

            button {
                padding: 5px 8px;
                font-size: 0.85rem;
            }

            #container {
                padding: 30px;
                width: auto;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <nav class="navbar navbar-expand-lg sm-body-tertiary change-link">
            <div class="container-fluid">
              <!-- <a class="navbar-brand" href="index.html">Home</a> -->
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex gap-3">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="../index-about.html">Main</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="../people/index-people.html">Key Figures</a>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Timeline
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="../timeline/index-timeline1.html">1860s-1886 (Pre-color line)</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../timeline/index-timeline2.html">1887-1919 (Pre-Negro League)</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../timeline/index-timeline3.html">1920-1931 (NNL I)</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../timeline/index-timeline4.html">1933-1948 (NNL II)</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../timeline/index-timeline5.html">Integration (1947)</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../timeline/index-timeline6.html">End of Negro Leagues (1947-1960s)</a></li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Viz
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="index-attendance.html">Fan Attendance</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="index-map.html">Map</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="index-players.html">Demographics</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="index-ncaa.html">NCAA Changes</a></li>
                    </ul>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="../index-sources.html">Sources</a>
                  </li>
              </div>
            </div>
          </nav>
      </div>
    <div class="summary">
        <h2>A Comparison of Negro League Playing Statistics</h2>
        <p class="info">When the MLB decided in 2024 to incorporate Negro League statistics into the official record book, there was much debate
        and skepticism. <span>The leagues, playing style, and season length were "different".</span> However, one must
        understand that those differences came from the constraints imposed during the time of segregation. Negro Leagues did
        what they could with the resources they had under the given circumstances.</p>
        <p class="rules">Select a button below to view player stats</p>
        <ul class="plays">
            <li><a href="https://www.mlb.com/glossary/standard-stats/at-bat" target="_blank">AB - At Bats</a></li>
            <li><a href="https://www.mlb.com/glossary/standard-stats/run" target="_blank">R - Runs</a></li>
            <li><a href="https://www.mlb.com/glossary/standard-stats/hit" target="_blank">H - Hits</a></li>
            <li><a href="https://www.mlb.com/glossary/standard-stats/home-run" target="_blank">HR - Home Runs</a></li>
            <li><a href="https://www.mlb.com/glossary/standard-stats/runs-batted-in" target="_blank">RBI - Runs Batted In</a></li>
            <li><a href="https://www.mlb.com/glossary/standard-stats/stolen-base" target="_blank">SB - Stolen Bases</a></li>
            <li><a href="https://www.mlb.com/glossary/standard-stats/batting-average" target="_blank">AVG - Batting Average</a></li>
        </ul>
        <p class="shrink-text">NOTE: Stats differed based on the website. These stats came from MLB.com through the history of the negro leagues
        section and were selected because it only utilized the statistics from their time during the negro leagues, excluding
        any data from MLB stints. (Ex: <a href="https://www.mlb.com/history/negro-leagues/players/josh-gibson"
            target="_blank">Source</a>).</p>
    </div>

    <div class="button-move">
        <button onclick="update('ab')">AB</button>
        <button onclick="update('r')">R</button>
        <button onclick="update('h')">H</button>
        <button onclick="update('hr')">HR</button>
        <button onclick="update('rbi')">RBI</button>
        <button onclick="update('sb')">SB</button>
        <button onclick="update('avg')">AVG</button>
    </div>
    <div id="container"></div>

    <script>
      const margin = { top: 30, right: 110, bottom: 70, left: 120 };

      // Get container width dynamically
      const container = document.getElementById("container");
      const width = container.clientWidth - margin.left - margin.right;
      const height = 650 - margin.top - margin.bottom; // or make this also relative

      const svg = d3.select("#container")
        .append("svg")
        .attr("class", "svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`) // ðŸ‘ˆ important
        .attr("preserveAspectRatio", "xMidYMid meet")
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);


      // CREATE TOOLTIP
      // TOOLTIP - REQUIRES 3 FUNCTIONS
      const tooltip = d3.select("#container")
          .append("div")
          .attr("class", "tooltip") //class for styling in CSS
          .style("opacity", 0); //opacity set to 0 is invisible until used
    

      // INITIALIZE X-AXIS
      const x = d3.scaleLinear()
        .range([0, width])
      const xAxis = svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .attr("class", "x-axis")
        

      // INITIALIZE Y-AXIS
      const y = d3.scaleBand()
        .range([height, 0])
        .padding(1);
      const yAxis = svg.append("g")
        .attr("class", "y-axis")



      // DEFINE FUNCTION UPDATE THAT CREATES/UPDATES THE CHART FOR GIVEN VARIABLE
      //THIS UPDATE IS CONNECTED TO THE BUTTONS ONCLICK"UPDATE" IN HTML
      function update(selectedStat) {

        // LOAD/PARSE DATA
        d3.csv("../data/player-stats.csv").then(data => {

          console.log('data', data);

          //FORMAT THE DATA
                data.forEach(d => {
                  d.name = d.name;
                  d.ab = d.ab;
                  d.r = d.r;
                  d.h = +d.h;
                  d.hr = +d.hr;
                  d.rbi = +d.rbi;
                  d.sb = +d.sb;
                  d.avg = +d.avg;
                });
          
          //SORT THE DATA - descending  
          data.sort((a, b) => b.name - a.name);//not working
          //data.sort(d3.ascending) //doesn't work

          // X-AXIS
          x.domain([0, d3.max(data, d => +d[selectedStat])])
          xAxis
            .transition()
            .duration(1000)
            .call(d3.axisBottom(x))
            .selectAll("text")
            .attr("fill", "black")
            .attr("font-weight", 500)


          // Y-AXIS
          y.domain(data.map(d => d.name));
          yAxis
          .transition()
          .duration(1000)
          .call(d3.axisLeft(y))
          .selectAll("text")
          .attr("fill", "black");


          //1ST TOOLTIP FUNCTION - MOUSEOVER
          const mouseover = function (event, d) {  //listen for events being triggered on done elements
            tooltip  //give things to the tooltip
              .html(d.name + " - " + +d[selectedStat])//can add HTML features, like line break
              .style("opacity", 1) //opacity set to 1 is visible - mouse hovers & you can see it
              //Add absolute position of mouse b/c tooltip follows mouse
              .style("left", (event.pageX + 8) + "px")//mouse x coordinate - higher the # further away tooltip moves
              .style("top", (event.pageY + 8) + "px");//mouse y coordinate - higher the # further away tooltip moves
          }

          //2nd TOOLTIP FUNCTION - MOUSEMOVE
          //Use event & d
          const mousemove = function (event, d) {
            tooltip
              .style("left", (event.pageX + 8) + "px") //higher the # further away tooltip moves
              .style("top", (event.pageY + 8) + "px"); //higher the # further away tooltip moves
          }

          //3rd TOOLTIP FUNCTION - MOUSEOUT
          //Use event & d
          const mouseout = function (event, d) {
            tooltip
              .style("opacity", 0); //invisible when cursor leaves
          }


          // VARIABLE J: MAP DATA TO EXISTING CIRCLE
          const j = svg.selectAll(".myLine")
            .data(data)
          // update lines
          j
            .enter()
            .append("line")
            .attr("class", "myLine")
            .merge(j)
            .transition()
            .duration(1000)
            .attr("x1", d => x(+d[selectedStat]))
            .attr("x2", d => x(0))
            .attr("y1", d => y(d.name))
            .attr("y2", d => y(d.name))
            .attr("stroke", "#718a9b");


          // VARIABLE U: MAP DATA TO EXISTING CIRCLE
          const u = svg.selectAll("circle")
            .data(data)
          // UPDATE CIRCLE
          u
            .enter()
            .append("circle")
            .merge(u)
            .on("mouseover", mouseover) //NEW: .on() - this is event
            .on("mousemove", mousemove) //tells it what to do 
            .on("mouseout", mouseout)
            .transition()
            .duration(1000)
            .attr("cx", d => x(+d[selectedStat]))
            .attr("cy", d => y(d.name))
            .attr("r", 6)
            .style("fill", "#B23124")
            .attr("stroke", "#222224");
        })
      }

      // INITIALIZE PLOT
      update('name')
    </script>
</body>

</html>